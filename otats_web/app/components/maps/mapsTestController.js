angular.module('app').controller('mapsTestController', function ($scope, $http, $interval, NgMap) {
    CreateSiteMap();
    hideLoadingPage();

    $scope.init = function () {
        //$scope.loadgrid();

        //$scope.loadpmprogress();
    }

    var options = {
        imagePath: 'assets/img/m'
    };

    var locations = [{ "id": 189498, "ten": "Kh bình an", "kinhdo": 105.851959, "vido": 20.98011, "icon_path": "images/kh/06.png" }, { "id": 23931, "ten": "đại kim", "kinhdo": 105.8360476, "vido": 20.9760043, "icon_path": "" }, { "id": 33749, "ten": "Phạm Duy", "kinhdo": 105.9114719, "vido": 21.0561921, "icon_path": "" }, { "id": 33750, "ten": "HOÀNG fpt", "kinhdo": 105.9114719, "vido": 21.0561921, "icon_path": "" }, { "id": 66852, "ten": "hbnf", "kinhdo": 105.836082, "vido": 20.9758539, "icon_path": "images/kh/06.png" }, { "id": 5062, "ten": "Công Ty TNHH Thương Mại Và Vận Tải Ngọc Dũng", "kinhdo": 105.8906859, "vido": 20.994941, "icon_path": "" }, { "id": 5063, "ten": "Công Ty Cổ Phần Thương Mại Vận Tải Vàng", "kinhdo": 105.8884966, "vido": 21.0548635, "icon_path": "" }, { "id": 5064, "ten": "Công Ty TNHH Mai Hưng An", "kinhdo": 105.8040796, "vido": 21.0046148, "icon_path": "" }, { "id": 5065, "ten": "Công Ty Cổ Phần Du Lịch Thương Mại Việt Trung", "kinhdo": 105.857075, "vido": 21.0021999, "icon_path": "" }, { "id": 5066, "ten": "Công Ty Cổ Phần Thiết Bị Tân Phát", "kinhdo": 105.834962844849, "vido": 21.0365384922135, "icon_path": "" }, { "id": 5068, "ten": "Công Ty Cổ Phần Công Nghiệp Phụ Trợ TPL Việt Nam", "kinhdo": 105.8906859, "vido": 20.994941, "icon_path": "" }, { "id": 5069, "ten": "Công Ty TNHH Hưng Phát", "kinhdo": 105.7690729, "vido": 20.9657144, "icon_path": "" }, { "id": 5070, "ten": "Công Ty TNHH Sản Xuất Và Thương Mại Điện Cơ Mạnh Q", "kinhdo": 106.6880841, "vido": 20.8449115, "icon_path": "" }, { "id": 5073, "ten": "Công Ty TNHH Sản Xuất Thương Mại Cơ Khí Hồng Ký", "kinhdo": 106.5896103, "vido": 10.770795, "icon_path": "" }, { "id": 5074, "ten": "Công Ty Cổ Phần Thiết Bị Và Kỹ Thuật Phương Đông", "kinhdo": 105.8465244, "vido": 21.0240179, "icon_path": "" }, { "id": 5075, "ten": "Công Ty TNHH Lan Minh Nguyễn", "kinhdo": 106.6703272, "vido": 10.798044, "icon_path": "" }, { "id": 5076, "ten": "Công Ty TNHH Kỹ Thuật Điện Công Trình", "kinhdo": 106.627624, "vido": 10.7894539, "icon_path": "" }, { "id": 5077, "ten": "Công Ty Cổ Phần Kỹ Thuật Thương Mại An Thanh Sơn", "kinhdo": 105.8099499, "vido": 21.0417308, "icon_path": "" }, { "id": 5078, "ten": "Công Ty CP Đầu Tư Xây Lắp Và Thương Mại Việt Nam", "kinhdo": 105.8571612, "vido": 20.9880703, "icon_path": "" }, { "id": 5079, "ten": "Công Ty Cổ Phần Sản Xuất Và Dịch Vụ Thiên Phúc", "kinhdo": 105.830941, "vido": 21.033335, "icon_path": "" }, { "id": 5080, "ten": "Công Ty TNHH MTV Sản Xuất Thương Mại Tân Vũ Gia", "kinhdo": 106.8499477, "vido": 10.9548881, "icon_path": "" }, { "id": 5082, "ten": "Công Ty TNHH Tư Vấn Xây Lắp & Thương Mại Lộc Thành", "kinhdo": 108.2123455, "vido": 16.0210001, "icon_path": "" }, { "id": 5083, "ten": "Công Ty TNHH Kiến Việt", "kinhdo": 106.6770456, "vido": 10.8416305, "icon_path": "" }, { "id": 5085, "ten": "Công Ty TNHH Thương Mại Dịch Vụ Khổng Gia", "kinhdo": 106.6703272, "vido": 10.798044, "icon_path": "" }, { "id": 5087, "ten": "Công Ty TNHH Hoàng Bảo Ngân", "kinhdo": 106.666569, "vido": 10.77898, "icon_path": "" }, { "id": 5092, "ten": "Công Ty TNHH Dịch Vụ Suất Ăn Công Nghiệp Phương Na", "kinhdo": 105.830943, "vido": 21.0268954, "icon_path": "" }, { "id": 5093, "ten": "Công Ty TNHH Komasu Việt Nam", "kinhdo": 105.795835, "vido": 20.964331, "icon_path": "" }, { "id": 5094, "ten": "Công Ty Cổ Phần Đầu Tư SX & TM Minh Toàn", "kinhdo": 105.7874992, "vido": 21.0824315, "icon_path": "images/kh/06.png" }, { "id": 5095, "ten": "Công Ty TNHH Sản Xuất Và Thương Mại An Hưng", "kinhdo": 105.800175, "vido": 20.995714, "icon_path": "" }, { "id": 5097, "ten": "Công Ty TNHH Công Nghiệp & Bảo Hộ Lao Động Ba Miền", "kinhdo": 106.5967126, "vido": 20.8164393, "icon_path": "" }, { "id": 5098, "ten": "Công Ty TNHH Hoàng Thịnh TBD", "kinhdo": 106.640223, "vido": 10.851053, "icon_path": "" }, { "id": 5099, "ten": "Công Ty CP SX & May Mặc Bảo Hộ Lao Động Bảo Minh", "kinhdo": 105.8607507, "vido": 21.0090571, "icon_path": "" }, { "id": 5100, "ten": "Công Ty TNHH MTV Đạt Phúc An", "kinhdo": 106.6703963, "vido": 11.0689943, "icon_path": "" }, { "id": 5101, "ten": "Công Ty TNHH Thương Mại Và Đầu Tư Tân Đức Minh", "kinhdo": 106.6671549, "vido": 20.840883, "icon_path": "" }, { "id": 5102, "ten": "Công Ty TNHH Quốc Tế Sao Đỏ", "kinhdo": 105.8164762, "vido": 21.0186126, "icon_path": "" }, { "id": 5103, "ten": "Công Ty TNHH Thương Mại Ngọc Thành Đạt", "kinhdo": 106.6330105, "vido": 10.8035188, "icon_path": "" }, { "id": 5104, "ten": "Công Ty TNHH Kỹ Thuật SAVICO Miền Nam", "kinhdo": 106.627236, "vido": 10.8075839, "icon_path": "" }, { "id": 5105, "ten": "Công Ty TNHH Thiết Bị Phụ Tùng LTP Việt Nam", "kinhdo": 106.614012, "vido": 10.853612, "icon_path": "" }, { "id": 5106, "ten": "Công Ty Cổ Phần Cà Phê Mê Trang", "kinhdo": 109.1856718, "vido": 12.2931433, "icon_path": "" }, { "id": 5107, "ten": "Công Ty TNHH MTV TM DV & SX Hồng Hà", "kinhdo": 107.0539434, "vido": 12.0392238, "icon_path": "" }, { "id": 5109, "ten": "Công Ty TNHH Sản Xuất Và Thương Mại An Lộc", "kinhdo": 105.8571612, "vido": 20.9880703, "icon_path": "" }, { "id": 5111, "ten": "Công Ty TNHH Thương Mại Dịch Vụ Và Sản Xuất C&T", "kinhdo": 105.7995918, "vido": 21.014578, "icon_path": "" }, { "id": 5112, "ten": "Công Ty TNHH Thương Mại Hòa Mai", "kinhdo": 106.693378, "vido": 10.80217, "icon_path": "" }, { "id": 5114, "ten": "Công Ty TNHH Đồ Chơi Và TBGD Nam Phúc Hưng", "kinhdo": 106.1776725, "vido": 20.4249428, "icon_path": "" }, { "id": 5115, "ten": "Công Ty TNHH Công Nghệ Anh Phát", "kinhdo": 105.859129, "vido": 20.995356, "icon_path": "" }, { "id": 5118, "ten": "Công Ty Cổ Phần Thương Mại Và Quốc Tế Nam Bảo Hưng", "kinhdo": 105.886864, "vido": 21.053208, "icon_path": "" }, { "id": 5071, "ten": "Công Ty CP Đầu Tư Xây Dựng Và Thương Mại Thế Long", "kinhdo": 105.7512223, "vido": 20.9456245, "icon_path": "" }, { "id": 5096, "ten": "Công Ty TNHH MTV Vĩnh Thực", "kinhdo": 105.834962844849, "vido": 21.0365384922135, "icon_path": "" }, { "id": 5116, "ten": "Công Ty CP TM SX & Truyền Thông QC Đương Thời", "kinhdo": 105.8554513, "vido": 20.9751142, "icon_path": "" }, { "id": 5120, "ten": "Công Ty TNHH LPK", "kinhdo": 105.8638648, "vido": 20.985084, "icon_path": "" }, { "id": 12980, "ten": "Nguyễn Thị Hương", "kinhdo": 105.8008323, "vido": 20.9816581, "icon_path": "" }, { "id": 12981, "ten": "Đặng Văn Tâm", "kinhdo": 105.8679933, "vido": 21.0417603, "icon_path": "" }, { "id": 17756, "ten": "Nguyen Manh Truong", "kinhdo": 105.834175, "vido": 21.027685, "icon_path": "" }, { "id": 17759, "ten": "MINHMINH", "kinhdo": 105.834175, "vido": 21.027685, "icon_path": "" }, { "id": 17829, "ten": "Nguyễn Thái Mạnh", "kinhdo": 105.835851, "vido": 21.033713, "icon_path": "" }, { "id": 17868, "ten": "cafe jet", "kinhdo": 105.792247, "vido": 21.089158, "icon_path": "" }, { "id": 17931, "ten": "kha", "kinhdo": 105.83063, "vido": 20.9946567, "icon_path": "" }, { "id": 18387, "ten": "nguyễn tử", "kinhdo": 106.7729062, "vido": 10.8193863, "icon_path": "" }, { "id": 20539, "ten": "Golden Link", "kinhdo": 106.6554297, "vido": 10.7918041, "icon_path": "" }, { "id": 21153, "ten": "mavin", "kinhdo": 105.8129517, "vido": 21.0013567, "icon_path": "" }, { "id": 21485, "ten": "Mai Linh", "kinhdo": 105.79588, "vido": 20.964435, "icon_path": "" }, { "id": 23940, "ten": "Nguyễn đức cảnh", "kinhdo": 105.836016, "vido": 20.975905, "icon_path": "images/kh/06.png" }, { "id": 27635, "ten": "cty mast", "kinhdo": 105.87673, "vido": 21.002865, "icon_path": "" }, { "id": 30352, "ten": "testnt", "kinhdo": 105.8651005, "vido": 21.0508578, "icon_path": "" }, { "id": 107153, "ten": "Trần Thị Bình", "kinhdo": 105.8256639, "vido": 21.0063358, "icon_path": "images/kh/01.png" }, { "id": 154005, "ten": "Gaia", "kinhdo": 105.835945, "vido": 20.975809, "icon_path": "images/kh/01.png" }, { "id": 30416, "ten": "lac hong tech", "kinhdo": 105.8355826, "vido": 20.9759961, "icon_path": "images/kh/06.png" }, { "id": 33735, "ten": "demo", "kinhdo": 105.7597133, "vido": 20.9419, "icon_path": "" }, { "id": 33736, "ten": "demo", "kinhdo": 105.7604417, "vido": 20.9413683, "icon_path": "" }, { "id": 33738, "ten": "test124", "kinhdo": 105.865289, "vido": 21.0508194, "icon_path": "" }, { "id": 33739, "ten": "test124", "kinhdo": 105.865289, "vido": 21.0508194, "icon_path": "" }, { "id": 33740, "ten": "test124", "kinhdo": 105.865289, "vido": 21.0508194, "icon_path": "" }, { "id": 33741, "ten": "test124", "kinhdo": 105.865289, "vido": 21.0508194, "icon_path": "" }, { "id": 33742, "ten": "test124", "kinhdo": 105.865289, "vido": 21.0508194, "icon_path": "" }, { "id": 33743, "ten": "test124", "kinhdo": 105.865289, "vido": 21.0508194, "icon_path": "" }, { "id": 33744, "ten": "test124", "kinhdo": 105.865289, "vido": 21.0508194, "icon_path": "" }, { "id": 33746, "ten": "test124", "kinhdo": 105.865289, "vido": 21.0508194, "icon_path": "" }, { "id": 33747, "ten": "tryuong", "kinhdo": 105.8652894, "vido": 21.0507778, "icon_path": "" }, { "id": 33748, "ten": "demo 1", "kinhdo": 105.7595617, "vido": 20.9421917, "icon_path": "" }, { "id": 34480, "ten": "Mast", "kinhdo": 105.8766259, "vido": 21.0027518, "icon_path": "" }, { "id": 67645, "ten": "cty lac hong tech", "kinhdo": 105.836082, "vido": 20.9758539, "icon_path": "images/kh/06.png" }, { "id": 69707, "ten": "Cửa hàng điện tử Minh Anh", "kinhdo": 105.810243606567, "vido": 21.0270451288479, "icon_path": "images/kh/06.png" }, { "id": 69749, "ten": "Công ty TNHH Hồng Anh - Cấu giấy - Hà nội", "kinhdo": 108.807708740234, "vido": 12.2860997010492, "icon_path": "images/kh/06.png" }, { "id": 79999, "ten": "test truong", "kinhdo": 105.865021, "vido": 21.050745, "icon_path": "images/kh/06.png" }, { "id": 108937, "ten": "Trần văn nhi", "kinhdo": 105.83723, "vido": 20.99578, "icon_path": "images/kh/06.png" }, { "id": 23939, "ten": "khu dtm đại kim", "kinhdo": 105.83606, "vido": 20.975776, "icon_path": "" }, { "id": 26406, "ten": "Nguyễn Mạnh Quyết", "kinhdo": 105.8759099, "vido": 20.9647534, "icon_path": "" }, { "id": 30358, "ten": "Nguyễn Tùng Dương", "kinhdo": 105.8310215, "vido": 20.9945371, "icon_path": "" }, { "id": 30359, "ten": "Hà Anh Tuấn", "kinhdo": 105.8299495, "vido": 21.0180725, "icon_path": "" }, { "id": 39798, "ten": "jjsjsnb", "kinhdo": 105.836038, "vido": 20.975842, "icon_path": "" }, { "id": 33752, "ten": "Thanh Tùng", "kinhdo": 105.9114719, "vido": 21.0561921, "icon_path": "" }, { "id": 33754, "ten": "Hà Hương", "kinhdo": 105.8362311, "vido": 20.976168, "icon_path": "" }, { "id": 34504, "ten": "Kinh Bắc", "kinhdo": 106.167692, "vido": 20.994059, "icon_path": "" }, { "id": 39549, "ten": "Bằng Lăng", "kinhdo": 105.9118173, "vido": 21.0561377, "icon_path": "" }, { "id": 39964, "ten": "minh hoa", "kinhdo": 105.835965, "vido": 20.975929, "icon_path": "" }, { "id": 45850, "ten": "cửa hàng điều hoà", "kinhdo": 105.835984, "vido": 20.975887, "icon_path": "" }, { "id": 48196, "ten": "hoàng mai", "kinhdo": 105.8360853, "vido": 20.9759005, "icon_path": "" }, { "id": 48413, "ten": "hjks", "kinhdo": 105.836049, "vido": 20.975831, "icon_path": "" }, { "id": 48286, "ten": "nth", "kinhdo": 105.8360591, "vido": 20.9758788, "icon_path": "" }, { "id": 5117, "ten": "Công Ty TNHH Thương Mại Và Sản Xuất Vĩnh Tiến", "kinhdo": 105.83605, "vido": 20.975839, "icon_path": "" }, { "id": 5119, "ten": "Công Ty TNHH Văn Minh", "kinhdo": 105.846335, "vido": 21.037036, "icon_path": "" }, { "id": 5121, "ten": "Công Ty TNHH Sản Xuất Thương Mại Hóa Chất Lê Thanh", "kinhdo": 105.836051, "vido": 20.975812, "icon_path": "" }, { "id": 5122, "ten": "Công Ty TNHH MTV Dịch Vụ Bảo Vệ Bảo An Việt Nam", "kinhdo": 105.836092, "vido": 20.975802, "icon_path": "" }, { "id": 6889, "ten": "Công ty Hoàn Mỹ", "kinhdo": 105.8120807, "vido": 21.0081105, "icon_path": "" }, { "id": 12887, "ten": "Trần Phú", "kinhdo": 105.836048, "vido": 20.975818, "icon_path": "" }, { "id": 17719, "ten": "Nguyen Manh Truong", "kinhdo": 105.834175, "vido": 21.027685, "icon_path": "" }, { "id": 20544, "ten": "chị thảo budmo", "kinhdo": 105.836041, "vido": 20.975817, "icon_path": "" }, { "id": 28583, "ten": "Minh Anh", "kinhdo": 105.7712916, "vido": 21.0334844, "icon_path": "" }, { "id": 29233, "ten": "chị lan", "kinhdo": 105.792258, "vido": 21.089351, "icon_path": "" }, { "id": 30464, "ten": "trà thảo dược", "kinhdo": 105.816981315613, "vido": 21.0424665304583, "icon_path": "" }, { "id": 30504, "ten": "test", "kinhdo": 105.8319282021, "vido": 21.0233580133812, "icon_path": "" }, { "id": 33755, "ten": "Nguyễn Mai Anh", "kinhdo": 105.8359559, "vido": 20.976013, "icon_path": "" }, { "id": 33916, "ten": "KS Lake View", "kinhdo": 105.8213924, "vido": 21.0274898, "icon_path": "" }, { "id": 33921, "ten": "KS Lake View 3 ", "kinhdo": 105.8213924, "vido": 21.0274898, "icon_path": "" }, { "id": 33922, "ten": "KS Lake View 2", "kinhdo": 105.8213924, "vido": 21.0274898, "icon_path": "" }, { "id": 34439, "ten": "Nhà thuốc Linh", "kinhdo": 105.846642, "vido": 20.986404, "icon_path": "" }, { "id": 36037, "ten": "Ngọc hà", "kinhdo": 105.823504447937, "vido": 21.0395025408263, "icon_path": "" }, { "id": 38704, "ten": "khx1", "kinhdo": 105.8361658, "vido": 20.9759592, "icon_path": "" }, { "id": 45534, "ten": "Nguyễn Mai Phương", "kinhdo": 105.775279947705, "vido": 21.0301678287056, "icon_path": "" }, { "id": 75988, "ten": "Phan huy chu", "kinhdo": 105.8571617, "vido": 21.0201081, "icon_path": "" }, { "id": 82217, "ten": "hfjfjf", "kinhdo": 105.8361317, "vido": 20.9759748, "icon_path": "" }, { "id": 96585, "ten": "test0001", "kinhdo": 105.835606575012, "vido": 21.0354169449267, "icon_path": "" }, { "id": 102048, "ten": "3S - Sài Gòn Newland", "kinhdo": 106.7685765, "vido": 10.7890992, "icon_path": "" }, { "id": 116486, "ten": "Testhuong0948474", "kinhdo": 105.8361404, "vido": 20.9759825, "icon_path": "" }, { "id": 131420, "ten": "Nguyễn Mạnh Trường", "kinhdo": 105.8372201, "vido": 20.9957597, "icon_path": "" }, { "id": 155358, "ten": "Vnstar", "kinhdo": 105.835968, "vido": 20.975782, "icon_path": "" }, { "id": 156270, "ten": "Kh them moi", "kinhdo": 105.835945, "vido": 20.975809, "icon_path": "" }, { "id": 185504, "ten": "fsdà", "kinhdo": 105.835959, "vido": 20.975761, "icon_path": "" }, { "id": 226524, "ten": "test", "kinhdo": 105.835985, "vido": 20.975825, "icon_path": "" }];


    var dynMarkers = [];

    NgMap.getMap().then(function (map) {

        $scope.map = map;

        var count = 0;
        var line = map.shapes.foo;
        $interval(function () {
            count = (count + 1) % 200;
            var icons = line.get('icons');
            icons[0].offset = (count / 2) + '%';
            line.set('icons', icons);
        }, 100);

        for (var i = 0; i < locations.length; i++) {
            var latLng = new google.maps.LatLng(locations[i].vido, locations[i].kinhdo);
            dynMarkers.push(new google.maps.Marker({ position: latLng }));
        }

        $scope.markerClusterer = new MarkerClusterer(map, dynMarkers, options);

    });

    $scope.stores = {
        foo: { position: [20.9718498, 105.8342872], items: [1, 2, 3, 4] },
        bar: { position: [20.9722133, 105.8353718], items: [5, 6, 7, 8] }
    };

    $scope.showStore = function (evt, storeId) {
        console.log('showStore');
        $scope.store = $scope.stores[storeId];
        $scope.map.showInfoWindow('foo', this);
    };
    $scope.mouseover = function () {
        console.log('mouseover');
    };

    
    $scope.init();

})